name: Sync-up

on:
  push:
    branches: [ main ]

jobs:
  update-and-run:
    # This must match YOUR labels exactly
    runs-on: [self-hosted, Linux, x64, docker]
    
    steps:
      # 1. Pull the code. 
      # 'fetch-depth: 0' and 'clean: false' are better for large datasets 
      # so it doesn't re-download everything every time.
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          clean: false

      # 2. Force the local 3090 to match GitHub (solves the 'local changes' error)
      - name: Reset to Remote
        run: |
          git fetch origin main
          git reset --hard origin/main
          git clean -fd
        
      - name: Link Heavy Storage
        run: |
          # Create symbolic links so the code sees 'data/' and 'checkpoints/'
          # but the files actually live safely in ~/ai_storage
          ln -sfn /home/fypits25/Documents/ted_backyard/ai_storage/datasets ./data
          ln -sfn /home/fypits25/Documents/ted_backyard/ai_storage/checkpoints ./checkpoints